<!-- userlist.component.html -->
<div class="container-fluid mt--7">
  <div class="row">
    <div class="col">
      <div class="card shadow">

        <!-- Card header with New button on right -->
        <div class="card-header border-0 d-flex justify-content-between align-items-center">
          <h3 class="mb-0">
            <i class="fas fa-users me-2"></i>User Table
          </h3>

          <!-- IMPORTANT: type="button" to avoid accidental form submit -->
          <button type="button" class="btn btn-primary" (click)="openCreateModal()">
            <i class="fas fa-plus"></i> New
          </button>
        </div>

        <div class="table-responsive">
          <table class="table align-items-center table-flush">
            <thead class="thead-light">
              <tr>
                <th><i class="fas fa-user me-1"></i> First Name</th>
                <th><i class="fas fa-user me-1"></i> Last Name</th>
                <th><i class="fas fa-envelope me-1"></i> Email</th>
                <th><i class="fas fa-phone me-1"></i> Phone</th>
                <th><i class="fas fa-user-tag me-1"></i> Role</th>
                <th><i class="fas fa-cog me-1"></i> Actions</th>
              </tr>
            </thead>
            <tbody *ngIf="paginatedUsers.length > 0; else noUsers">
              <tr *ngFor="let user of paginatedUsers">
                <td>{{ user.firstname || 'No firstname' }}</td>
                <td>{{ user.lastname || 'No lastname' }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phone }}</td>
                <td>{{ user.role }}</td>
                <td>
                  <button type="button" class="btn btn-sm btn-warning me-2" (click)="openEditModal(user)" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-danger" (click)="confirmDelete(user)" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
            </tbody>

            <ng-template #noUsers>
              <tbody>
                <tr>
                  <td colspan="6" class="text-center">
                    <i class="fas fa-info-circle me-2"></i>No users found.
                  </td>
                </tr>
              </tbody>
            </ng-template>
          </table>

          <!-- Pagination -->
          <div class="d-flex justify-content-between align-items-center p-3 border-top">
            <div class="text-muted small">
              Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
              {{ getVisibleEnd() }} of {{ totalItems }} users
            </div>
            
            <div>
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a class="page-link" (click)="previousPage()">&laquo;</a>
                </li>
                <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
                  <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                  <a class="page-link" (click)="nextPage()">&raquo;</a>
                </li>
              </ul>
            </div>
            
            <div class="d-flex align-items-center">
              <span class="me-2 small">Show:</span>
              <select class="form-select form-select-sm" style="width: 70px;" 
                      [(ngModel)]="itemsPerPage" (change)="currentPage = 1; refreshPaginatedData()">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
              </select>
            </div>
          </div> <!-- /pagination -->
        </div> <!-- /table-responsive -->

      </div> <!-- /card -->
    </div>
  </div>
</div>

<!-- Modal overlay & content (placed at end of template) -->
<!-- overlay catches outside clicks -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()"></div>

<!-- wrapper centers the modal -->
<div class="modal-content-wrapper user-modal" *ngIf="isModalOpen">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <i class="fas" [ngClass]="isCreating ? 'fa-user-plus' : 'fa-user-edit'"></i>
        {{ isCreating ? 'Create User' : 'Edit User' }}
      </h3>
      <button (click)="closeModal()" class="close-btn" type="button">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form (ngSubmit)="isCreating ? createUser() : updateUser()" #userForm="ngForm" novalidate>
      <div class="modal-body">
        <!-- First Name -->
        <div class="form-group">
          <label for="firstname" class="form-label">
            <i class="fas fa-user me-1"></i>First Name
          </label>
          <input
            type="text"
            id="firstname"
            class="form-control"
            [(ngModel)]="selectedUser.firstname"
            name="firstname"
            required
          />
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="lastname" class="form-label">
            <i class="fas fa-user me-1"></i>Last Name
          </label>
          <input
            type="text"
            id="lastname"
            class="form-control"
            [(ngModel)]="selectedUser.lastname"
            name="lastname"
            required
          />
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email" class="form-label">
            <i class="fas fa-envelope me-1"></i>Email
          </label>
          <input
            type="email"
            id="email"
            class="form-control"
            [(ngModel)]="selectedUser.email"
            name="email"
            required
            email
          />
        </div>

        <!-- Password (creation only) -->
        <div class="form-group" *ngIf="isCreating">
          <label for="password" class="form-label">
            <i class="fas fa-lock me-1"></i>Password
          </label>
          <input
            type="password"
            id="password"
            class="form-control"
            [(ngModel)]="selectedUser.password"
            name="password"
            required
          />
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label for="phone" class="form-label">
            <i class="fas fa-phone me-1"></i>Phone
          </label>
          <input
            type="text"
            id="phone"
            class="form-control"
            [(ngModel)]="selectedUser.phone"
            name="phone"
          />
        </div>

        <!-- Role -->
        <div class="form-group">
          <label for="role" class="form-label">
            <i class="fas fa-user-tag me-1"></i>Role
          </label>
          <input
            type="text"
            id="role"
            class="form-control"
            [(ngModel)]="selectedUser.role"
            name="role"
            required
          />
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="closeModal()">
          <i class="fas fa-times me-1"></i>Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid">
          <i class="fas" [ngClass]="isCreating ? 'fa-user-plus' : 'fa-save'"></i>
          {{ isCreating ? 'Create User' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>
